## 五、实验结果及分析

### 5.2 HEAD、GET、POST方法的实验结果与分析

为了测试我们实现的HTTP Echo Web Server，我们编写了一系列测试脚本并使用不同的HTTP客户端进行测试。以下是测试结果和分析：

#### 1. GET方法测试

**测试用例**：

- 请求存在的文件（/index.html）
- 请求不存在的文件（/nonexistent.html）
- 请求根目录（/）

**测试命令**：

```bash
curl -v http://localhost:9999/index.html
curl -v http://localhost:9999/nonexistent.html
curl -v http://localhost:9999/
```

**测试结果**：

- 请求存在的文件时，服务器正确返回200 OK状态码和文件内容
- 请求不存在的文件时，服务器正确返回404 Not Found状态码
- 请求根目录时，服务器正确返回默认页面（index.html）

**分析**：
GET方法的实现符合HTTP协议规范，能够正确处理文件请求和错误情况。服务器能够正确识别文件类型并设置Content-Type头部，同时返回正确的Content-Length。当请求的文件不存在时，服务器能够正确返回404错误，符合RFC 2616的规定。

#### 2. HEAD方法测试

**测试用例**：

- 请求存在的文件（/index.html）
- 请求不存在的文件（/nonexistent.html）
- 请求根目录（/）

**测试命令**：

```bash
curl -I http://localhost:9999/index.html
curl -I http://localhost:9999/nonexistent.html
curl -I http://localhost:9999/
```

**测试结果**：

- 请求存在的文件时，服务器正确返回200 OK状态码和HTTP头部，但没有返回文件内容
- 请求不存在的文件时，服务器正确返回404 Not Found状态码
- 请求根目录时，服务器正确返回默认页面的头部信息

**分析**：
HEAD方法的实现正确遵循了HTTP协议规范，只返回HTTP头部而不返回文件内容。这对于客户端检查资源是否存在或获取资源元数据非常有用，同时减少了网络传输量。服务器能够正确处理HEAD请求，并返回与GET请求相同的头部信息，符合RFC 2616的规定。

#### 3. POST方法测试

**测试用例**：

- 发送简单数据
- 发送表单数据
- 发送JSON数据

**测试命令**：

```bash
curl -v -X POST -d "Hello, this is a test message" http://localhost:9999/echo
curl -v -X POST -d "username=test&password=123" http://localhost:9999/submit
curl -v -X POST -H "Content-Type: application/json" -d '{"name":"test","value":123}' http://localhost:9999/api
```

**测试结果**：

- 服务器正确接收POST数据并返回200 OK状态码
- 服务器将接收到的原始请求内容作为响应返回给客户端
- 不同类型的POST数据都能被正确处理

**分析**：
POST方法的实现能够正确接收客户端发送的数据，并按照Echo服务器的要求将原始请求内容作为响应返回。这验证了服务器能够正确处理HTTP请求体。服务器能够处理不同类型的POST数据，包括纯文本、表单数据和JSON数据，显示了实现的灵活性和健壮性。

#### 4. 错误处理测试

**测试用例**：

- 使用不支持的HTTP方法（PUT）
- 使用不支持的HTTP版本（HTTP/2.0）
- 发送格式错误的请求
- 请求不存在的文件

**测试命令**：

```bash
curl -v -X PUT http://localhost:9999/index.html
printf "GET /index.html HTTP/2.0\r\nHost: localhost\r\n\r\n" | nc localhost 9999
printf "INVALID REQUEST\r\n\r\n" | nc localhost 9999
curl -v http://localhost:9999/nonexistent.html
```

**测试结果**：

- 使用不支持的HTTP方法时，服务器正确返回501 Not Implemented状态码
- 使用不支持的HTTP版本时，服务器正确返回505 HTTP Version not supported状态码
- 发送无效请求格式时，服务器正确返回400 Bad Request状态码
- 请求不存在的文件时，服务器正确返回404 Not Found状态码

**分析**：
错误处理机制能够正确识别并处理各种错误情况，返回适当的HTTP状态码。这提高了服务器的健壮性和安全性，防止了潜在的安全漏洞和崩溃风险。服务器能够正确处理HTTP协议中定义的各种错误情况，并返回符合RFC 2616规定的错误响应。

#### 5. 持久连接测试

**测试用例**：

- 发送多个请求，检查连接是否保持

**测试命令**：

```bash
printf "GET /index.html HTTP/1.1\r\nHost: localhost\r\nConnection: keep-alive\r\n\r\nGET /another.html HTTP/1.1\r\nHost: localhost\r\nConnection: close\r\n\r\n" | nc localhost 9999
```

**测试结果**：

- 服务器能够正确处理持久连接
- 当Connection头部为keep-alive时，服务器保持连接
- 当Connection头部为close时，服务器关闭连接

**分析**：
持久连接的实现符合HTTP/1.1协议规范，能够减少连接建立和关闭的开销，提高服务器性能。服务器能够正确解析Connection头部，并根据其值决定是否保持连接，这对于处理多个请求的客户端非常有用。

#### 6. 性能测试

**测试用例**：

- 100个请求，10个并发
- 500个请求，50个并发
- 使用keep-alive的100个请求，10个并发

**测试命令**：

```bash
ab -n 100 -c 10 http://localhost:9999/index.html
ab -n 500 -c 50 http://localhost:9999/index.html
ab -n 100 -c 10 -k http://localhost:9999/index.html
```

**测试结果**：

- 服务器能够稳定处理并发请求
- 平均响应时间在可接受范围内
- 使用keep-alive时，性能有明显提升
- 没有出现请求失败或服务器崩溃的情况

**分析**：
服务器在处理并发请求时表现良好，能够高效地处理多个客户端连接。使用持久连接（keep-alive）时，服务器性能有明显提升，这验证了持久连接实现的有效性。服务器能够稳定处理高并发请求，没有出现崩溃或请求失败的情况，显示了实现的健壮性。

#### 7. 日志记录测试

**测试方法**：

- 运行各种测试用例，然后检查日志文件

**测试结果**：

- 错误日志正确记录了服务器运行过程中的错误和异常情况
- 访问日志正确记录了每个请求的处理情况，包括客户端IP、端口、HTTP方法、URI、版本、状态码和内容长度
- 日志格式符合Apache日志格式规范

**分析**：
日志记录模块的实现符合要求，能够正确记录服务器运行过程中的各种情况。错误日志和访问日志的格式符合Apache日志格式规范，便于后续分析和调试。日志记录对于服务器的监控和问题排查非常有用，是服务器实现的重要组成部分。
